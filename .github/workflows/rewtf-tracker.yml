name: REWTF Activity Tracker

on:
  push:
    branches: [ main, develop, master ]
  pull_request:
    branches: [ main, master ]
  schedule:
    # Her gün saat 12:00'da çalış (UTC)
    - cron: '0 12 * * *'

jobs:
  track-activity:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: Check if Node.js project
      id: check-node
      run: |
        if [ -f "package.json" ]; then
          echo "has-package-json=true" >> $GITHUB_OUTPUT
        else
          echo "has-package-json=false" >> $GITHUB_OUTPUT
        fi
        
    - name: Install dependencies
      if: steps.check-node.outputs.has-package-json == 'true'
      run: npm install
      
    - name: Run linting (if available)
      if: steps.check-node.outputs.has-package-json == 'true'
      run: |
        if npm run lint 2>/dev/null; then
          echo "✅ Linting passed"
        else
          echo "⚠️ Linting not configured, skipping"
        fi
      continue-on-error: true
      
    - name: Build project (if available)
      if: steps.check-node.outputs.has-package-json == 'true'
      run: |
        if npm run build 2>/dev/null; then
          echo "✅ Build successful"
        else
          echo "⚠️ Build script not available, skipping"
        fi
      continue-on-error: true
      
    - name: REWTF Activity Log
      run: |
        echo "🏆 REWTF Activity Logged!"
        echo "📊 Commit: ${{ github.sha }}"
        echo "👤 Author: ${{ github.actor }}"
        echo "📅 Date: $(date)"
        echo "🌊 Flow Project: Fortefication - Automated DeFi Portfolio Manager"
        echo "🎯 Features: Portfolio Management, Risk Analysis, Automated Rebalancing"
        echo "⚡ Tech Stack: Cadence, Flow FCL, Next.js, TypeScript"
        echo "📈 Leaderboard: https://app.databox.com/datawall/fc5f1f7de13471eac8bd5eb2e3d90a752817ac68a86fd6"
        
    - name: Comment on PR (if PR)
      if: github.event_name == 'pull_request'
      uses: actions/github-script@v7
      with:
        script: |
          github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: '🏆 **REWTF Tracker**: Bu PR Fortefication projesine katkı sağlıyor! 🚀\n\n' +
                  '💼 **Proje**: Automated DeFi Portfolio Manager\n' +
                  '🌊 **Blockchain**: Flow\n' +
                  '⚡ **Tech**: Cadence + FCL + Next.js\n\n' +
                  '#ReWTF #FlowBlockchain #DeFi #Fortefication'
          })